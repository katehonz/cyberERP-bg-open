# Tenant Selector (–ò–∑–±–æ—Ä –Ω–∞ —Ñ–∏—Ä–º–∞)

## –û–±—â –ø—Ä–µ–≥–ª–µ–¥

–°–∏—Å—Ç–µ–º–∞—Ç–∞ –∑–∞ –∏–∑–±–æ—Ä –Ω–∞ —Ñ–∏—Ä–º–∞ (tenant selector) –ø–æ–∑–≤–æ–ª—è–≤–∞ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏—Ç–µ –¥–∞ –ø—Ä–µ–≤–∫–ª—é—á–≤–∞—Ç –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω–∏ —Ñ–∏—Ä–º–∏ –≤ Cyber ERP. –ò–∑–±—Ä–∞–Ω–∞—Ç–∞ —Ñ–∏—Ä–º–∞ —Å–µ –∑–∞–ø–∞–∑–≤–∞ –≤ –±—Ä–∞—É–∑—ä—Ä–∞ –∏ —Å–µ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞ –ø—Ä–∏ —Å–ª–µ–¥–≤–∞—â–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç

### 1. Persistence (–ó–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –∏–∑–±–æ—Ä–∞)

–¢–µ–∫—É—â–∞—Ç–∞ —Ñ–∏—Ä–º–∞ —Å–µ –∑–∞–ø–∞–∑–≤–∞ –≤:
- **localStorage** - –±—Ä–∞—É–∑—ä—Ä–Ω–æ —Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç –ø—Ä–∏ –ø—Ä–µ–∑–∞—Ä–µ–∂–¥–∞–Ω–µ
- **LiveView socket** - —Å–µ—Å–∏–π–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ —Ä–∞–±–æ—Ç–∞

### 2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

#### JavaScript Hook (`apps/cyber_web/assets/js/hooks/tenant_selector.js`)

```javascript
export const TenantSelector = {
  mounted() {
    this.el.addEventListener("change", (e) => {
      const tenantId = e.target.value;
      localStorage.setItem("currentTenantId", tenantId);
      window.location.reload();
    });
  }
};
```

**–§—É–Ω–∫—Ü–∏–∏:**
- –°–ª—É—à–∞ –∑–∞ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞
- –ó–∞–ø–∞–∑–≤–∞ –∏–∑–±–æ—Ä–∞ –≤ localStorage
- –ü—Ä–µ–∑–∞—Ä–µ–∂–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞ –∑–∞ –ø—Ä–∏–ª–∞–≥–∞–Ω–µ –Ω–∞ –Ω–æ–≤–∞—Ç–∞ —Ñ–∏—Ä–º–∞

#### LiveView Hook (`apps/cyber_web/lib/cyber_web/live/hooks/tenant_hook.ex`)

```elixir
def on_mount(:default, _params, session, socket) do
  requested_tenant_id =
    get_connect_params(socket)["tenant_id"] ||
      session["current_tenant_id"] ||
      1

  # ... –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–∞–Ω–µ –∫—ä–º integer

  tenants = Accounts.list_tenants()

  # –û–ø–∏—Ç–≤–∞–º–µ –¥–∞ –∑–∞—Ä–µ–¥–∏–º –∏—Å–∫–∞–Ω–∞—Ç–∞ —Ñ–∏—Ä–º–∞ –∏–ª–∏ –∏–∑–ø–æ–ª–∑–≤–∞–º–µ –ø—ä—Ä–≤–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω–∞
  current_tenant =
    case Accounts.get_tenant(requested_tenant_id) do
      nil -> List.first(tenants)
      tenant -> tenant
    end

  # ...
end
```

**–§—É–Ω–∫—Ü–∏–∏:**
- –ß–µ—Ç–µ tenant_id –æ—Ç localStorage (—á—Ä–µ–∑ connect params)
- –ó–∞—Ä–µ–∂–¥–∞ –¥–∞–Ω–Ω–∏ –∑–∞ —Ç–µ–∫—É—â–∞—Ç–∞ —Ñ–∏—Ä–º–∞
- –ó–∞—Ä–µ–∂–¥–∞ —Å–ø–∏—Å—ä–∫ —Å –≤—Å–∏—á–∫–∏ —Ñ–∏—Ä–º–∏
- –ê–∫–æ –∏—Å–∫–∞–Ω–∞—Ç–∞ —Ñ–∏—Ä–º–∞ –Ω–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞, –∏–∑–ø–æ–ª–∑–≤–∞ –ø—ä—Ä–≤–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω–∞
- –ü—Ä–∏–∫–∞—á–≤–∞ hooks –∑–∞ –ø—Ä–µ–≤–∫–ª—é—á–≤–∞–Ω–µ –Ω–∞ —Ñ–∏—Ä–º–∏

### 3. UI Components

#### –°–µ–ª–µ–∫—Ç–æ—Ä –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—è—Ç–∞ (`apps/cyber_web/lib/cyber_web/components/layouts/app.html.heex`)

```heex
<select
  id="tenant-selector"
  name="tenant_id"
  phx-hook="TenantSelector"
  class="w-full rounded-lg border-zinc-300">
  <%= for tenant <- @tenants do %>
    <option value={tenant.id} selected={tenant.id == @current_tenant_id}>
      <%= tenant.name %>
    </option>
  <% end %>
</select>
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (`/tenants`)

–°—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞ –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ñ–∏—Ä–º–∏ –ø–æ–∫–∞–∑–≤–∞:
- ‚úÖ –°–ø–∏—Å—ä–∫ —Å –≤—Å–∏—á–∫–∏ —Ñ–∏—Ä–º–∏
- üü¢ –í–∏–∑—É–∞–ª–Ω–∞ –∏–Ω–¥–∏–∫–∞—Ü–∏—è –∑–∞ —Ç–µ–∫—É—â–∞—Ç–∞ —Ñ–∏—Ä–º–∞ (–∑–µ–ª–µ–Ω —Ñ–æ–Ω + —Ç–æ—á–∫–∞)
- üîò –ë—É—Ç–æ–Ω "–ù–∞–ø—Ä–∞–≤–∏ –∞–∫—Ç–∏–≤–Ω–∞" –∑–∞ –ø—Ä–µ–≤–∫–ª—é—á–≤–∞–Ω–µ –Ω–∞ —Ñ–∏—Ä–º–∞
- ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Ñ–∏—Ä–º–∏
- ‚ûï –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –Ω–æ–≤–∏ —Ñ–∏—Ä–º–∏

**–í–∏–∑—É–∞–ª–Ω–∞ –∏–Ω–¥–∏–∫–∞—Ü–∏—è:**
```heex
<tr class={"hover:bg-zinc-50 #{if tenant.id == @current_tenant_id, do: "bg-green-50"}"}>
  <td>
    <div class="flex items-center">
      <div :if={tenant.id == @current_tenant_id}
           class="mr-2 h-2 w-2 rounded-full bg-green-500"></div>
      <%= tenant.name %>
    </div>
    <div :if={tenant.id == @current_tenant_id} class="text-xs text-green-600">
      –¢–µ–∫—É—â–∞ —Ñ–∏—Ä–º–∞
    </div>
  </td>
</tr>
```

**–ü—Ä–µ–≤–∫–ª—é—á–≤–∞–Ω–µ:**
```elixir
def handle_event("set_active", %{"id" => id}, socket) do
  {:noreply, push_event(socket, "set-active-tenant", %{tenant_id: id})}
end
```

JavaScript —Å–ª—É—à–∞—Ç–µ–ª –≤ `app.js`:
```javascript
window.addEventListener("phx:set-active-tenant", (e) => {
  const tenantId = e.detail.tenant_id
  localStorage.setItem("currentTenantId", tenantId)
  window.location.reload()
})
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        Browser                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ  localStorage   ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  TenantSelector Hook ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ currentTenantId ‚îÇ         ‚îÇ   (JavaScript)        ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îÇ           ‚îÇ                                                  ‚îÇ
‚îÇ           ‚îÇ (–ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ)                                 ‚îÇ
‚îÇ           ‚ñº                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ         LiveSocket connect params                 ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ         { tenant_id: "1" }                        ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚îÇ (WebSocket connection)
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     Phoenix Server                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ           TenantHook.on_mount/4                   ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  1. –ß–µ—Ç–µ tenant_id –æ—Ç connect params              ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  2. –ó–∞—Ä–µ–∂–¥–∞ tenant –æ—Ç DB                          ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  3. –ê–∫–æ –Ω–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞, –≤–∑–∏–º–∞ –ø—ä—Ä–≤–∏—è –Ω–∞–ª–∏—á–µ–Ω       ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  4. –ü—Ä–∏–∫–∞—á–≤–∞ –∫—ä–º socket.assigns                   ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îÇ                   ‚îÇ                                          ‚îÇ
‚îÇ                   ‚ñº                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ   socket.assigns                                  ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ   - current_tenant_id: 1                          ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ   - current_tenant: %Tenant{}                     ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ   - tenants: [%Tenant{}, ...]                     ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –†–∞–±–æ—Ç–µ–Ω –ø—Ä–æ—Ü–µ—Å (Flow)

### –ü—Ä–∏ –ø—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ:

1. **Browser** ‚Üí –ß–µ—Ç–µ `localStorage.getItem("currentTenantId")`
2. **LiveSocket** ‚Üí –ò–∑–ø—Ä–∞—â–∞ tenant_id –∫–∞—Ç–æ connect param
3. **TenantHook** ‚Üí –ü–æ–ª—É—á–∞–≤–∞ tenant_id –∏ –∑–∞—Ä–µ–∂–¥–∞ —Ñ–∏—Ä–º–∞—Ç–∞
4. **Response** ‚Üí –°—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞ —Å–µ —Ä–µ–Ω–¥–∏—Ä–∞ —Å –ø—Ä–∞–≤–∏–ª–Ω–∞—Ç–∞ —Ñ–∏—Ä–º–∞

### –ü—Ä–∏ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ —Ñ–∏—Ä–º–∞ (—á—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä):

1. **User** ‚Üí –ò–∑–±–∏—Ä–∞ –Ω–æ–≤–∞ —Ñ–∏—Ä–º–∞ –æ—Ç dropdown
2. **JavaScript Hook** ‚Üí –ó–∞–ø–∞–∑–≤–∞ –≤ localStorage
3. **Browser** ‚Üí –ü—Ä–µ–∑–∞—Ä–µ–∂–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞ (reload)
4. **–ü—Ä–æ—Ü–µ—Å—ä—Ç —Å–µ –ø–æ–≤—Ç–∞—Ä—è –æ—Ç —Å—Ç—ä–ø–∫–∞ 1**

### –ü—Ä–∏ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ —Ñ–∏—Ä–º–∞ (—á—Ä–µ–∑ "–ù–∞–ø—Ä–∞–≤–∏ –∞–∫—Ç–∏–≤–Ω–∞"):

1. **User** ‚Üí –ö–ª–∏–∫–≤–∞ –±—É—Ç–æ–Ω–∞ "–ù–∞–ø—Ä–∞–≤–∏ –∞–∫—Ç–∏–≤–Ω–∞"
2. **LiveView** ‚Üí –ò–∑–ø—Ä–∞—â–∞ event `set_active`
3. **Server** ‚Üí –í—Ä—ä—â–∞ JS event `phx:set-active-tenant`
4. **JavaScript** ‚Üí –ó–∞–ø–∞–∑–≤–∞ –≤ localStorage –∏ –ø—Ä–µ–∑–∞—Ä–µ–∂–¥–∞

## Error Handling (–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –≥—Ä–µ—à–∫–∏)

### –°–ª—É—á–∞–π 1: –ò—Å–∫–∞–Ω–∞—Ç–∞ —Ñ–∏—Ä–º–∞ –Ω–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞

```elixir
current_tenant =
  case Accounts.get_tenant(requested_tenant_id) do
    nil ->
      # –í–∑–µ–º–∞–º–µ –ø—ä—Ä–≤–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω–∞ —Ñ–∏—Ä–º–∞
      case tenants do
        [] -> nil
        [first | _] -> first
      end
    tenant ->
      tenant
  end
```

**–†–µ–∑—É–ª—Ç–∞—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–µ–≤–∫–ª—é—á–≤–∞ –∫—ä–º –ø—ä—Ä–≤–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω–∞ —Ñ–∏—Ä–º–∞.

### –°–ª—É—á–∞–π 2: –ù—è–º–∞ —Ñ–∏—Ä–º–∏ –≤ —Å–∏—Å—Ç–µ–º–∞—Ç–∞

```elixir
if current_tenant == nil do
  raise "–ù—è–º–∞ –Ω–∞–ª–∏—á–Ω–∏ —Ñ–∏—Ä–º–∏ –≤ —Å–∏—Å—Ç–µ–º–∞—Ç–∞. –ú–æ–ª—è, —Å—ä–∑–¥–∞–π—Ç–µ –ø–æ–Ω–µ –µ–¥–Ω–∞ —Ñ–∏—Ä–º–∞."
end
```

**–†–µ–∑—É–ª—Ç–∞—Ç:** –ü–æ–∫–∞–∑–≤–∞ —è—Å–Ω–æ —Å—ä–æ–±—â–µ–Ω–∏–µ –∑–∞ –≥—Ä–µ—à–∫–∞.

## –§–∞–π–ª–æ–≤–µ

### Frontend
- `apps/cyber_web/assets/js/hooks/tenant_selector.js` - JavaScript hook
- `apps/cyber_web/assets/js/app.js` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ hook –∏ event listener
- `apps/cyber_web/lib/cyber_web/components/layouts/app.html.heex` - –°–µ–ª–µ–∫—Ç–æ—Ä –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—è—Ç–∞

### Backend
- `apps/cyber_web/lib/cyber_web/live/hooks/tenant_hook.ex` - LiveView hook –∑–∞ tenant
- `apps/cyber_core/lib/cyber_core/accounts.ex` - –ë–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞ –∑–∞ tenants

### UI
- `apps/cyber_web/lib/cyber_web/live/tenant_live/index.ex` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `apps/cyber_web/lib/cyber_web/live/tenant_live/index.html.heex` - UI –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ñ–∏—Ä–º–∏

## –¢–µ—Å—Ç–≤–∞–Ω–µ

### –¢–µ—Å—Ç 1: –ü—Ä–µ–∑–∞—Ä–µ–∂–¥–∞–Ω–µ –∑–∞–ø–∞–∑–≤–∞ –∏–∑–±–æ—Ä–∞
1. –ò–∑–±–µ—Ä–∏ —Ñ–∏—Ä–º–∞ –æ—Ç —Å–µ–ª–µ–∫—Ç–æ—Ä–∞
2. –ü—Ä–µ–∑–∞—Ä–µ–¥–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞ (F5)
3. ‚úÖ –°—ä—â–∞—Ç–∞ —Ñ–∏—Ä–º–∞ –µ –∏–∑–±—Ä–∞–Ω–∞

### –¢–µ—Å—Ç 2: –ü—Ä–µ–≤–∫–ª—é—á–≤–∞–Ω–µ —á—Ä–µ–∑ "–ù–∞–ø—Ä–∞–≤–∏ –∞–∫—Ç–∏–≤–Ω–∞"
1. –û—Ç–∏–¥–∏ –Ω–∞ /tenants
2. –ö–ª–∏–∫–Ω–∏ "–ù–∞–ø—Ä–∞–≤–∏ –∞–∫—Ç–∏–≤–Ω–∞" –Ω–∞ –¥—Ä—É–≥–∞ —Ñ–∏—Ä–º–∞
3. ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞ —Å–µ –ø—Ä–µ–∑–∞—Ä–µ–∂–¥–∞ —Å –Ω–æ–≤–∞—Ç–∞ —Ñ–∏—Ä–º–∞

### –¢–µ—Å—Ç 3: –ü—ä—Ä–≤–∞ —Ñ–∏—Ä–º–∞ –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–µ–Ω ID
1. localStorage –∏–º–∞ tenant_id=999 (–Ω–µ—Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∞ —Ñ–∏—Ä–º–∞)
2. –ü—Ä–µ–∑–∞—Ä–µ–¥–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞
3. ‚úÖ –ü—ä—Ä–≤–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω–∞ —Ñ–∏—Ä–º–∞ —Å–µ –∏–∑–±–∏—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

## –ú–∏–≥—Ä–∞—Ü–∏—è –æ—Ç session-based –∫—ä–º localStorage

**–ü—Ä–µ–¥–∏:**
- –§–∏—Ä–º–∞—Ç–∞ —Å–µ –∑–∞–ø–∞–∑–≤–∞—à–µ —Å–∞–º–æ –≤ Phoenix session
- –ü—Ä–∏ –ø—Ä–µ–∑–∞—Ä–µ–∂–¥–∞–Ω–µ —Å–µ –∑–∞–≥—É–±–≤–∞—à–µ

**–°–ª–µ–¥:**
- –§–∏—Ä–º–∞—Ç–∞ —Å–µ –∑–∞–ø–∞–∑–≤–∞ –≤ localStorage
- –ü—Ä–∏ –ø—Ä–µ–∑–∞—Ä–µ–∂–¥–∞–Ω–µ —Å–µ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞
- Session —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –∫–∞—Ç–æ fallback

## Roadmap

### –ë—ä–¥–µ—â–∏ –ø–æ–¥–æ–±—Ä–µ–Ω–∏—è:
- [ ] Multi-tab —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (BroadcastChannel API)
- [ ] –ó–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏ 5 –∏–∑–ø–æ–ª–∑–≤–∞–Ω–∏ —Ñ–∏—Ä–º–∏
- [ ] Keyboard shortcuts –∑–∞ –ø—Ä–µ–≤–∫–ª—é—á–≤–∞–Ω–µ (Ctrl+1, Ctrl+2, etc.)
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–µ–≤–∫–ª—é—á–≤–∞–Ω–µ –±–µ–∑ –ø—Ä–µ–∑–∞—Ä–µ–∂–¥–∞–Ω–µ (Live Navigation)
