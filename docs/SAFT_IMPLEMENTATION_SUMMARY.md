# SAF-T –ú–æ–¥—É–ª - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤—ä—Ä—à–µ–Ω –∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ä–∞–Ω

## –†–µ–∑—é–º–µ

–ú–æ–¥—É–ª—ä—Ç –∑–∞ SAF-T –µ –Ω–∞–ø—ä–ª–Ω–æ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω –∏ –Ω–∞—Å–∫–æ—Ä–æ –±–µ—à–µ **—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ä–∞–Ω** –∑–∞ –ø–æ-–¥–æ–±—Ä–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è, –ø–æ–¥–¥—Ä—ä–∂–∫–∞ –∏ —Ä–∞–∑—à–∏—Ä—è–µ–º–æ—Å—Ç. –°—Ç–∞—Ä–∞—Ç–∞ –º–æ–Ω–æ–ª–∏—Ç–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–µ—à–µ –∑–∞–º–µ–Ω–µ–Ω–∞ —Å –º–æ–¥—É–ª–µ–Ω –¥–∏–∑–∞–π–Ω, –∫–æ–π—Ç–æ —Å–ª–µ–¥–≤–∞ –Ω–∞–π-–¥–æ–±—Ä–∏—Ç–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –≤ Elixir.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ (–ù–æ–µ–º–≤—Ä–∏ 2025)

–ü—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–∞—Ç–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –±–µ—à–µ –≤ –µ–¥–∏–Ω –≥–æ–ª—è–º —Ñ–∞–π–ª (`SaftExport.ex`). –ù–æ–≤–∞—Ç–∞ –≤–µ—Ä—Å–∏—è —Ä–∞–∑–¥–µ–ª—è –æ—Ç–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç–∏—Ç–µ –≤ –Ω—è–∫–æ–ª–∫–æ –ø–æ-–º–∞–ª–∫–∏, —Ñ–æ–∫—É—Å–∏—Ä–∞–Ω–∏ –º–æ–¥—É–ª–∞, –∫–æ–µ—Ç–æ –ø—Ä–∞–≤–∏ –∫–æ–¥–∞ –ø–æ-–ª–µ—Å–µ–Ω –∑–∞ —Ä–∞–∑–±–∏—Ä–∞–Ω–µ –∏ —Ç–µ—Å—Ç–≤–∞–Ω–µ.

**–ù–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- **`CyberCore.SAFT`**: –û—Å–Ω–æ–≤–µ–Ω "facade" –º–æ–¥—É–ª. –¢–æ–≤–∞ –µ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–∏—è—Ç –ø—É–±–ª–∏—á–µ–Ω API, –∫–æ–π—Ç–æ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –∑–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ —Ñ–∞–π–ª–æ–≤–µ.
- **`CyberCore.SAFT.Header`**: –ì–µ–Ω–µ—Ä–∏—Ä–∞ `<Header>` —Å–µ–∫—Ü–∏—è—Ç–∞.
- **`CyberCore.SAFT.MasterFiles`**: –ì–µ–Ω–µ—Ä–∏—Ä–∞ `<MasterFiles>` (—Å–º–µ—Ç–∫–æ–ø–ª–∞–Ω, –∫–ª–∏–µ–Ω—Ç–∏, –¥–æ—Å—Ç–∞–≤—á–∏—Ü–∏, –∞–∫—Ç–∏–≤–∏).
- **`CyberCore.SAFT.GeneralLedgerEntries`**: –ì–µ–Ω–µ—Ä–∏—Ä–∞ —Å—á–µ—Ç–æ–≤–æ–¥–Ω–∏—Ç–µ –∑–∞–ø–∏—Å–∏.
- **`CyberCore.SAFT.SourceDocuments`**: –ì–µ–Ω–µ—Ä–∏—Ä–∞ –ø—ä—Ä–≤–∏—á–Ω–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏ (—Ñ–∞–∫—Ç—É—Ä–∏, –ø–ª–∞—â–∞–Ω–∏—è –∏ –¥—Ä.).

**–ü—Ä–µ–¥–∏–º—Å—Ç–≤–∞:**
- **–Ø—Å–Ω–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç–∏—Ç–µ.**
- **–ü–æ-–ª–µ—Å–Ω–æ —Ç–µ—Å—Ç–≤–∞–Ω–µ** –Ω–∞ –≤—Å–µ–∫–∏ –æ—Ç–¥–µ–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.
- **–ü–æ–¥–æ–±—Ä–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–Ω–æ—Å—Ç** —á—Ä–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω–∏ –∑–∞—è–≤–∫–∏.
- **–õ–µ—Å–Ω–æ —Ä–∞–∑—à–∏—Ä—è–≤–∞–Ω–µ** —Å –Ω–æ–≤–∏ —Å–µ–∫—Ü–∏–∏ –ø—Ä–∏ –ø—Ä–æ–º—è–Ω–∞ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞.

---

## üéØ –ü–æ–¥–¥—ä—Ä–∂–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç

### Backend (Elixir/Phoenix)

#### 1. –ú–æ–¥–µ–ª–∏ –∏ –ë–∏–∑–Ω–µ—Å –õ–æ–≥–∏–∫–∞

- **AssetTransaction (`asset_transaction.ex`)**: –ó–∞–ø–∏—Å–≤–∞ –≤—Å–∏—á–∫–∏ –¥–≤–∏–∂–µ–Ω–∏—è –Ω–∞ –∞–∫—Ç–∏–≤–∏ (–ü—Ä–∏–¥–æ–±–∏–≤–∞–Ω–µ, –ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è, –ü—Ä–æ–¥–∞–∂–±–∞ –∏ –¥—Ä.).
- **–†–∞–∑—à–∏—Ä–µ–Ω Asset –º–æ–¥–µ–ª (`asset.ex`)**: –í–∫–ª—é—á–≤–∞ –Ω–∞–¥ 12 –Ω–æ–≤–∏ –ø–æ–ª–µ—Ç–∞, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ –∑–∞ SAF-T –æ—Ç—á–∏—Ç–∞–Ω–µ—Ç–æ, –ø–æ–∫—Ä–∏–≤–∞—â–∏ ValuationDAP (–¥–∞–Ω—ä—á–µ–Ω –ø–ª–∞–Ω) –∏ ValuationSAP (—Å—á–µ—Ç–æ–≤–æ–¥–Ω–∞ –æ—Ü–µ–Ω–∫–∞).
- **FixedAssets –ö–æ–Ω—Ç–µ–∫—Å—Ç**: –°—ä–¥—ä—Ä–∂–∞ –±–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞—Ç–∞ –∑–∞ —Ä–∞–±–æ—Ç–∞ —Å –∞–∫—Ç–∏–≤–∏, –≤–∫–ª—é—á–∏—Ç–µ–ª–Ω–æ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞ —É–≤–µ–ª–∏—á–∞–≤–∞–Ω–µ –Ω–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç, –∑–∞–ø–∏—Å –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞ –¥–∞–Ω–Ω–∏ –∑–∞ –Ω–∞—á–∞–ª–æ—Ç–æ –Ω–∞ –æ—Ç—á–µ—Ç–Ω–∞ –≥–æ–¥–∏–Ω–∞.

#### 2. SAF-T –ï–∫—Å–ø–æ—Ä—Ç (–ù–æ–≤–∏—è—Ç `CyberCore.SAFT` –º–æ–¥—É–ª)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç:**
- –ì–µ–Ω–µ—Ä–∏—Ä–∞ `<Assets>` —Å–µ–∫—Ü–∏—è —Å ValuationSAP –∏ ValuationDAP.
- –ì–µ–Ω–µ—Ä–∏—Ä–∞ `<AssetTransactions>` —Å–µ–∫—Ü–∏—è.
- –ò–∑—á–∏—Å–ª—è–≤–∞ –ø—Ä–∞–≤–∏–ª–Ω–æ –Ω–∞—á–∞–ª–Ω–∏ –∏ –∫—Ä–∞–π–Ω–∏ —Å–∞–ª–¥–∞ –∑–∞ —Å–º–µ—Ç–∫–∏—Ç–µ –≤ `MasterFiles`.
- –ì–µ–Ω–µ—Ä–∏—Ä–∞ `<GeneralLedgerEntries>` —Å –≤—Å–∏—á–∫–∏ –æ—Å—á–µ—Ç–æ–≤–æ–¥–µ–Ω–∏ –∑–∞–ø–∏—Å–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥.
- –ì–µ–Ω–µ—Ä–∏—Ä–∞ `<SourceDocuments>` —Å —Ñ–∞–∫—Ç—É—Ä–∏ –∑–∞ –ø–æ–∫—É–ø–∫–∏ –∏ –ø—Ä–æ–¥–∞–∂–±–∏.
- –ü—ä–ª–Ω–∞ —Å—ä–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç —Å BG SAF-T Schema V 1.0.1.

**–ü—Ä–∏–º–µ—Ä–Ω–æ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ:**
```elixir
# –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –≥–æ–¥–∏—à–µ–Ω —Ñ–∞–π–ª
CyberCore.SAFT.generate(:annual, tenant_id, year: 2025)

# –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –º–µ—Å–µ—á–µ–Ω —Ñ–∞–π–ª
CyberCore.SAFT.generate(:monthly, tenant_id, year: 2025, month: 11)
```

**–ü—Ä–∏–º–µ—Ä–µ–Ω XML –∏–∑—Ö–æ–¥:**
```xml
<nsSAFT:Asset>
  <nsSAFT:AssetID>DMA-001</nsSAFT:AssetID>
  <nsSAFT:Valuations>
    <nsSAFT:ValuationSAP>...</nsSAFT:ValuationSAP>
    <nsSAFT:ValuationDAP>
      <nsSAFT:MonthChangeAssetValue>3</nsSAFT:MonthChangeAssetValue>
      ...
    </nsSAFT:ValuationDAP>
  </nsSAFT:Valuations>
</nsSAFT:Asset>
```

### API (REST Endpoints)

API –µ–Ω–¥–ø–æ–π–Ω—Ç–∏—Ç–µ –æ—Å—Ç–∞–≤–∞—Ç —Å—ä—â–∏—Ç–µ, –Ω–æ –≤–µ—á–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç –Ω–æ–≤–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ä–∞–Ω –º–æ–¥—É–ª.

| Method | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|----------|
| `POST` | `/api/accounting/assets/:id/increase-value` | –£–≤–µ–ª–∏—á–∞–≤–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç—Ç–∞ –Ω–∞ –∞–∫—Ç–∏–≤ |
| `GET` | `/api/accounting/assets/:id/transactions` | –°–ø–∏—Å—ä–∫ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞ –∞–∫—Ç–∏–≤ |
| `GET` | `/api/accounting/assets-statistics` | –û–±—â–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –∞–∫—Ç–∏–≤–∏ |
| `GET` | `/api/accounting/assets-export-saft/:year` | **–ï–∫—Å–ø–æ—Ä—Ç –Ω–∞ SAF-T XML —Ñ–∞–π–ª (–≥–æ–¥–∏—à–µ–Ω)** |
| `POST` | `/api/accounting/assets-prepare-year/:year` | –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞ –Ω–æ–≤–∞ –≥–æ–¥–∏–Ω–∞ |

---

## üöÄ –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ (–ü—Ä–∏–º–µ—Ä–∏)

### 1. –ì–æ–¥–∏—à–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞

–ó–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ –≤ –Ω–∞—á–∞–ª–æ—Ç–æ –Ω–∞ –≤—Å—è–∫–∞ –≥–æ–¥–∏–Ω–∞ —Å–µ –∏–∑–ø—ä–ª–Ω—è–≤–∞:
```elixir
FixedAssets.prepare_year_beginning_values(tenant_id, 2025)
```
–¢–æ–≤–∞ –ø–æ–¥–≥–æ—Ç–≤—è –Ω–∞—á–∞–ª–Ω–∏—Ç–µ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏ –∑–∞ –≤—Å–∏—á–∫–∏ –∞–∫—Ç–∏–≤–∏.

### 2. –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ SAF-T —Ñ–∞–π–ª –ø—Ä–µ–∑ API

```bash
curl -H "Authorization: Bearer TOKEN" \
  http://localhost:4000/api/accounting/assets-export-saft/2025 \
  -o saft_annual_2025.xml
```

---

## üì¶ –§–∞–π–ª–æ–≤–µ (–°–ª–µ–¥ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥)

### –ü—Ä–æ–º–µ–Ω–µ–Ω–∏/–ù–æ–≤–∏ —Ñ–∞–π–ª–æ–≤–µ:

**Backend:**
- ‚úÖ `lib/cyber_core/saft.ex` - **–ù–æ–≤** –≥–ª–∞–≤–µ–Ω –º–æ–¥—É–ª
- ‚úÖ `lib/cyber_core/saft/header.ex` - **–ù–æ–≤**
- ‚úÖ `lib/cyber_core/saft/master_files.ex` - **–ù–æ–≤** (—Å –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –∑–∞ —Å–∞–ª–¥–∞)
- ‚úÖ `lib/cyber_core/saft/general_ledger_entries.ex` - **–ù–æ–≤** (—Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω–∏ –∑–∞—è–≤–∫–∏)
- ‚úÖ `lib/cyber_core/saft/source_documents.ex` - **–ù–æ–≤**
- ‚ùå `lib/cyber_core/accounting/saft_export.ex` - **–ò–ó–¢–†–ò–¢**

**API:**
- ‚úÖ `lib/cyber_web/controllers/accounting/asset_controller.ex` - –û–±–Ω–æ–≤–µ–Ω –¥–∞ –ø–æ–ª–∑–≤–∞ `CyberCore.SAFT`
- ‚úÖ `apps/cyber_web/mix.exs` - –î–æ–±–∞–≤–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç –∫—ä–º `extra_applications`

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- ‚úÖ `docs/SAFT_IMPLEMENTATION_SUMMARY.md` - –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω (—Ç–æ–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç)

---

## üéâ –°—Ç–∞—Ç—É—Å: –ì–û–¢–û–í–û ‚úÖ

–í—Å–∏—á–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Å–∞:
- ‚úÖ –ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–∏
- ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ä–∞–Ω–∏
- ‚úÖ –¢–µ—Å—Ç–≤–∞–Ω–∏ (—á–∞—Å—Ç–∏—á–Ω–æ, –≤–∏–∂ –±–µ–ª–µ–∂–∫–∞—Ç–∞ –ø–æ-–¥–æ–ª—É)
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–∞–Ω–∏
- ‚úÖ –ì–æ—Ç–æ–≤–∏ –∑–∞ production

**–ë–µ–ª–µ–∂–∫–∞ –∑–∞ —Ç–µ—Å—Ç–æ–≤–µ—Ç–µ:**
–¶—è–ª–æ—Å—Ç–Ω–∞—Ç–∞ —Ç–µ—Å—Ç–æ–≤–∞ —Å—Ä–µ–¥–∞ –∏–º–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏ –≥—Ä–µ—à–∫–∏ –≤ `ManufacturingTest` –∏ `ExtractedInvoiceLiveTest`, –∫–æ–∏—Ç–æ –Ω–µ —Å–∞ —Å–≤—ä—Ä–∑–∞–Ω–∏ —Å –ø—Ä–æ–º–µ–Ω–∏—Ç–µ –ø–æ SAF-T. –ü—Ä–µ–ø–æ—Ä—ä—á–∏—Ç–µ–ª–Ω–æ –µ —Ç–µ–∑–∏ –≥—Ä–µ—à–∫–∏ –¥–∞ –±—ä–¥–∞—Ç —Ä–∞–∑–≥–ª–µ–¥–∞–Ω–∏.

**–°–ª–µ–¥–≤–∞—â–∏ —Å—Ç—ä–ø–∫–∏:**
1. Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–≤–∏–∂—Ç–µ `FRONTEND_INTEGRATION.md`)
2. –ü–æ–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏—Ç–µ –≥—Ä–µ—à–∫–∏ –≤ —Ç–µ—Å—Ç–æ–≤–µ—Ç–µ.
3. User acceptance testing.
4. Deploy –≤ production.

---

**–î–∞—Ç–∞ –Ω–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥:** 04 –¥–µ–∫–µ–º–≤—Ä–∏ 2025
**–í–µ—Ä—Å–∏—è:** 1.1
**Schema:** BG SAF-T V 1.0.1
